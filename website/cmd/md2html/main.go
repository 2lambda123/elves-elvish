// Command md2html converts Markdown to HTML.
//
// It is tailored for converting the Markdown sources of the Elvish website
// (https://elv.sh) to HTML.
//
// It first applies a pre-processing step that expands the following macros:
//
//   - @module inserts elvdocs for a given module
//
//   - @ttyshot inserts a ttyshot
//
//   - @cf expands to a "see also" line for multiple symbols
//
//   - @dl expands to a binary download link
//
// The processed Markdown source is then converted to HTML using a codec based
// on [md.HTMLCodec], with the following additional features:
//
//   - Autogenerated ID for each heading
//
//   - Self link for each heading
//
//   - Generate a table of content (optional, turn on with <!-- toc -->)
//
//   - Generate section numbers for headings (optional, turn on with <--
//     number-sections -->)
//
//   - Syntax highlighting of code blocks with language elvish or
//     elvish-transcript
//
// The comment block for optional features should appear before the main text,
// and can contain multiple features (like <!-- toc number-sections -->).
//
// For general information about the Markdown implementation used by this
// command, see [src.elv.sh/pkg/md].
package main

import (
	"os"
	"strings"

	"src.elv.sh/pkg/md"
)

func main() {
	var expanded strings.Builder
	filter(os.Stdin, &expanded)

	codec := &htmlCodec{}
	codec.ConvertCodeBlock = convertCodeBlock
	md.Render(expanded.String(), md.SmartPunctsCodec{Inner: codec})
	os.Stdout.WriteString(codec.String())
}
